<!DOCTYPE html> <html lang="hi"> <head>     <meta charset="UTF-8">     <meta name="viewport" content="width=device-width, initial-scale=1.0">     <title>GreenGrow : India - फसल रोग डिटेक्टर</title>     <!-- Tailwind CSS CDN for styling -->     <script src="https://cdn.tailwindcss.com"></script>     <!-- Lucide Icons CDN -->     <script src="https://unpkg.com/lucide@latest"></script>     <style>         /* Custom font and base styles */         body {             font-family: 'Inter', sans-serif;             background-color: #f8fbf8;         }         /* Custom styling for the primary green color */         .green-primary {             background-color: #10B981; /* Emerald 500 */         }         .green-text-primary {             color: #059669; /* Emerald 600 */         }         /* Styling for the main card on mobile */         #app-container {             min-height: 100vh;             display: flex;             flex-direction: column;             justify-content: flex-start;             padding: 1rem;         }     </style> </head> <body>      <!-- Main Container -->     <div id="app-container" class="max-w-md mx-auto">                  <!-- Header & Branding -->         <header class="text-center py-6 bg-white rounded-xl shadow-lg mb-4">             <h1 class="text-3xl font-bold green-text-primary flex items-center justify-center">                 <i data-lucide="leaf" class="w-8 h-8 mr-2 text-green-600"></i>                 GreenGrow : India             </h1>             <p class="text-gray-500 text-sm mt-1">AI द्वारा संचालित, किसानों के लिए समाधान</p>         </header>          <!-- Configuration & API Keys -->         <script>             // TODO: **ज़रूरी:** यहाँ अपना WhatsApp नंबर बदलें             const WHATSAPP_NUMBER = '919876543210';                           // TODO: **ज़रूरी:** यहाँ अपना Gemini API Key डालें             const API_KEY = "";              const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;                          // WhatsApp Channel Link (जैसा आपने दिया)             const WHATSAPP_CHANNEL_LINK = "https://whatsapp.com/channel/0029Vb6RdgH2P59nRUzIle2c";         </script>          <!-- Main Card: Image Upload -->         <div id="upload-card" class="bg-white p-6 rounded-xl shadow-xl border border-green-200">                          <h2 class="text-xl font-semibold mb-4 text-gray-700">फसल रोग की जाँच करें</h2>                          <!-- Image Input & Preview -->             <input type="file" id="image-upload" accept="image/*" class="hidden" onchange="previewImage(event)">                          <label for="image-upload" id="upload-label"                    class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-green-400 rounded-lg cursor-pointer hover:bg-green-50 transition duration-150">                 <i data-lucide="camera" class="w-8 h-8 text-green-600 mb-2"></i>                 <span class="text-sm font-medium text-green-700">फोटो खींचने या अपलोड करने के लिए क्लिक करें</span>                 <span class="text-xs text-gray-500 mt-1">JPG या PNG फ़ाइल (पत्ती की स्पष्ट फोटो लें)</span>             </label>              <div id="image-preview-container" class="mt-4 hidden relative">                 <img id="image-preview" src="#" alt="Image Preview" class="w-full h-48 object-cover rounded-lg border-2 border-green-400">                 <button onclick="resetApp()" class="absolute top-2 right-2 p-1 bg-white rounded-full shadow-lg text-red-500 hover:bg-red-50 transition">                     <i data-lucide="x" class="w-5 h-5"></i>                 </button>             </div>              <!-- Action Button -->             <button id="detect-button" onclick="diagnoseDisease()"                      class="w-full green-primary text-white font-bold py-3 px-4 rounded-lg mt-6 shadow-md shadow-green-400/50 hover:shadow-lg hover:bg-green-700 transition duration-300"                     disabled>                 <i data-lucide="search" class="w-5 h-5 inline-block mr-2"></i> बीमारी का पता लगाएं             </button>         </div>          <!-- WhatsApp Channel Button (Prominent CTA) -->         <div class="mt-6 text-center">             <a id="channel-button" href="#" target="_blank"                class="inline-flex items-center green-text-primary bg-white border-2 border-green-400 font-bold py-3 px-6 rounded-lg shadow-xl hover:bg-green-50 transition duration-300">                 <i data-lucide="message-square" class="w-5 h-5 inline-block mr-2"></i> GreenGrow WhatsApp Channel से जुड़ें             </a>         </div>          <!-- Loading Indicator -->         <div id="loading-indicator" class="mt-6 text-center hidden">             <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"></div>             <p class="text-gray-600 mt-2 font-medium">जांच जारी है... कृपया प्रतीक्षा करें</p>         </div>                  <!-- Results Card -->         <div id="results-card" class="mt-6 p-6 bg-white rounded-xl shadow-xl border border-green-200 hidden">             <h2 class="text-2xl font-bold green-text-primary mb-4 flex items-center">                 <i data-lucide="clipboard-check" class="w-6 h-6 mr-2"></i> निदान रिपोर्ट             </h2>             <div id="detection-result" class="text-gray-700">                 <!-- AI Generated Content will be placed here -->             </div>              <!-- Consultation and Feedback Section -->             <div class="mt-8 pt-4 border-t border-gray-200">                 <h3 class="text-lg font-bold text-gray-800 mb-3">शीघ्र समाधान चाहिए?</h3>                 <p class="text-sm text-gray-600 mb-4">हमारी AI रिपोर्ट के आधार पर, एक कृषि विशेषज्ञ से WhatsApp पर 24 घंटे में व्यक्तिगत सलाह लें।</p>                                  <a id="consult-button" href="#" target="_blank"                    class="w-full bg-yellow-500 text-white font-bold py-3 px-4 rounded-lg shadow-md shadow-yellow-400/50 hover:shadow-lg hover:bg-yellow-600 transition duration-300 flex items-center justify-center">                     <i data-lucide="whatsapp" class="w-5 h-5 inline-block mr-2"></i> विशेषज्ञ से सलाह लें (₹100 शुल्क)                 </a>             </div>         </div>          <!-- Message/Error Box -->         <div id="message-box" class="mt-4 p-3 rounded-lg shadow-md text-sm hidden"></div>      </div>      <script>         document.addEventListener('DOMContentLoaded', (event) => {             // Initialize Lucide Icons             lucide.createIcons();                          // Set WhatsApp Channel link             document.getElementById('channel-button').href = WHATSAPP_CHANNEL_LINK;              // Set WhatsApp Consultation link             const consultButton = document.getElementById('consult-button');             const consultationMessage = encodeURIComponent("नमस्ते GreenGrow टीम, मैंने एक फसल रोग की फोटो भेजी है। मैं ₹100 का शुल्क चुकाकर व्यक्तिगत विशेषज्ञ परामर्श लेना चाहता/चाहती हूँ।");             consultButton.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${consultationMessage}`;         });          // Global variables for DOM elements         const imageUpload = document.getElementById('image-upload');         const uploadLabel = document.getElementById('upload-label');         const imagePreview = document.getElementById('image-preview');         const imagePreviewContainer = document.getElementById('image-preview-container');         const detectButton = document.getElementById('detect-button');         const loadingIndicator = document.getElementById('loading-indicator');         const resultsCard = document.getElementById('results-card');         const detectionResult = document.getElementById('detection-result');         const messageBox = document.getElementById('message-box');         let uploadedImageBase64 = null;           // Utility function to show custom messages         function showMessage(text, isError = false) {             messageBox.textContent = text;             messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');             if (isError) {                 messageBox.classList.add('bg-red-100', 'text-red-700');             } else {                 messageBox.classList.add('bg-green-100', 'text-green-700');             }         }                  // Converts file input to Base64 string         function previewImage(event) {             const file = event.target.files[0];             if (!file) {                 resetApp();                 return;             }              // Check file size (max 4MB for faster processing)             if (file.size > 4 * 1024 * 1024) {                 showMessage("क्षमा करें, छवि 4MB से बड़ी है। कृपया छोटी फ़ाइल चुनें।", true);                 resetApp();                 return;             }              const reader = new FileReader();             reader.onload = (e) => {                 imagePreview.src = e.target.result;                 imagePreviewContainer.classList.remove('hidden');                                  // Extract base64 part for API call                 const base64Parts = e.target.result.split(',');                 if (base64Parts.length > 1) {                     uploadedImageBase64 = base64Parts[1];                 } else {                     uploadedImageBase64 = e.target.result;                 }                  detectButton.disabled = false;                 resultsCard.classList.add('hidden');                 messageBox.classList.add('hidden');             };             reader.readAsDataURL(file);         }          // Resets the application state         function resetApp() {             imageUpload.value = null;             imagePreviewContainer.classList.add('hidden');             imagePreview.src = "#";             detectButton.disabled = true;             loadingIndicator.classList.add('hidden');             resultsCard.classList.add('hidden');             detectionResult.innerHTML = '';             uploadedImageBase64 = null;             messageBox.classList.add('hidden');         }          // Handles the API call for diagnosis         async function diagnoseDisease() {             if (!uploadedImageBase64 || detectButton.disabled) return;             if (!API_KEY) {                 showMessage("API Key सेट नहीं है। कृपया कोड में अपना API_KEY डालें।", true);                 return;             }              detectButton.disabled = true;             loadingIndicator.classList.remove('hidden');             resultsCard.classList.add('hidden');             messageBox.classList.add('hidden');             detectionResult.innerHTML = '';              const systemInstruction = "आप एक विशेषज्ञ कृषि वैज्ञानिक (Agronomist) हैं। दिए गए पौधे की पत्ती की छवि को ध्यान से देखें। अपनी प्रतिक्रिया केवल हिंदी में, पेशेवर और किसानों के लिए समझने में आसान भाषा में दें। निदान में ये 3 खंड शामिल होने चाहिए: 1. **संभावित रोग और निदान**, 2. **लक्षण और कारण**, 3. **उपचार और रोकथाम के उपाय** (रासायनिक और जैविक दोनों)। प्रत्येक खंड को बोल्ड हैडिंग के साथ Markdown का उपयोग करके फॉर्मेट करें।";              const userQuery = "कृपया इस पौधे/पत्ती की छवि का विश्लेषण करें और संभावित बीमारी, उसके कारण और उपचार के लिए पूर्ण हिंदी में निदान रिपोर्ट दें।";              const payload = {                 contents: [{                     parts: [                         { text: userQuery },                         {                             inlineData: {                                 mimeType: imageUpload.files[0].type,                                 data: uploadedImageBase64                             }                         }                     ]                 }],                 systemInstruction: {                     parts: [{ text: systemInstruction }]                 },             };              // Exponential backoff retry loop             const maxRetries = 3;             let currentDelay = 1000; // Start with 1 second delay              for (let attempt = 0; attempt < maxRetries; attempt++) {                 try {                     const response = await fetch(API_URL, {                         method: 'POST',                         headers: { 'Content-Type': 'application/json' },                         body: JSON.stringify(payload)                     });                      if (!response.ok) {                         if (response.status === 429 && attempt < maxRetries - 1) {                             // Rate limit exceeded, wait and retry                             await new Promise(resolve => setTimeout(resolve, currentDelay));                             currentDelay *= 2; // Double the delay                             continue; // Retry the request                         }                         throw new Error(`HTTP error! status: ${response.status}`);                     }                      const result = await response.json();                                          const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;                      if (text) {                         detectionResult.innerHTML = text.replace(/\n/g, '<br>'); // Display text, preserving newlines                         resultsCard.classList.remove('hidden');                         showMessage("निदान सफलतापूर्वक पूरा हुआ। रिपोर्ट नीचे देखें।");                     } else {                         throw new Error("AI से कोई परिणाम प्राप्त नहीं हुआ।");                     }                                          break; // Success, exit the loop                  } catch (error) {                     console.error('Error during API call:', error);                     if (attempt === maxRetries - 1) {                          showMessage(`निदान में समस्या आई। (${error.message})। कृपया फिर से प्रयास करें।`, true);                     }                 }             }              loadingIndicator.classList.add('hidden');             detectButton.disabled = false;         }     </script> </body> </html> 
